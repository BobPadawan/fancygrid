.js-fancygrid{ :class => fancygrid.name }
  - unless fancygrid.is_static?
    - if fancygrid.search_type.to_s != "simple"
      = render(:template => Fancygrid.extended_search_template, :locals => { :fancygrid => fancygrid })
    = render(:template => Fancygrid.controls_template, :locals => { :fancygrid => fancygrid, :css_class => "controls top" })
  .js-tablewrapper
    %table
      %tr.js-header
        - fancygrid.each_leaf do |leaf|
          %th{ :class => leaf.css_class }
            = leaf.human_name
      
      - if !fancygrid.is_static? && fancygrid.search_type.to_s == "simple"
        %tr.js-search
          - fancygrid.each_leaf do |leaf|
            %td{ :class => leaf.css_class }
              - if leaf.searchable
                %input.js-attribute{ :type => "text", :name => leaf.tag_name, :value => leaf.search_value }
      
      - if fancygrid.dataset
        - fancygrid.dataset.each do |record|
          %tr.js-row{ :class => fancygrid.evaluate_css_for(record) }
            - fancygrid.each_leaf do |leaf|
              %td{ :class => leaf.css_class }
                = render_fancygrid_leaf(record, leaf, &format_block)
                  
                
  - unless fancygrid.is_static?
    = render(:template => Fancygrid.controls_template, :locals => { :fancygrid => fancygrid, :css_class => "controls bottom" })

- unless fancygrid.is_static?
  :javascript
    $(function(){
      var fancyOptions = #{fancygrid.js_options};
      $(".js-fancygrid.#{fancygrid.name}").fancygrid(fancyOptions);
      if(!fancyOptions.instantFetchData){
        $(".js-fancygrid.#{fancygrid.name}").fancygrid("reloadPage");
      }
    });