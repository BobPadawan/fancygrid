.js-fancygrid{ :class => fancygrid.name }
  - if fancygrid.has_complex_search?
    = render(:template => Fancygrid.search_template, :locals => { :fancygrid => fancygrid })
  - if fancygrid.has_top_control?
    = render(:template => Fancygrid.controls_template, :locals => { :fancygrid => fancygrid, :css_class => "controls top" })

  .js-tablewrapper
    - unless fancygrid.is_static?
      %ul.js-search
        - fancygrid.each_visible_leaf do |leaf|
          - next unless leaf.searchable
          %li{ :class => leaf.css_class }
            %label{ :for => leaf.tag_name }
              = leaf.human_name
            %input.js-attribute{ :type => "text", :name => leaf.tag_name, :value => leaf.search_value }

    %ul.js-row
      - fancygrid.each_record do |record|
        %li{ :class => fancygrid.name.to_s.singularize }
          = render_fancygrid_leaf(record, fancygrid, &format_block)
  
  - if fancygrid.has_bottom_control?
    = render(:template => Fancygrid.controls_template, :locals => { :fancygrid => fancygrid, :css_class => "controls bottom" })

- unless fancygrid.is_static?
  :javascript
    $(function(){
      var fancyOptions = #{fancygrid.js_options};
      $(".js-fancygrid.#{fancygrid.name}").fancygrid(fancyOptions);
      if(!fancyOptions.isStatic){
        $(".js-fancygrid.#{fancygrid.name}").fancygrid("reloadPage");
      }
    });